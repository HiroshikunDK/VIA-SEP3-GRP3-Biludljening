@page "/createBooking"
@inject HttpClient Http
@using Shared.Dto

<h3>Book a Car</h3>

<div class="mb-3">
    <label for="Status" class="form-label">Status: </label>
    <div>
        <input type="string" id="Status" class="form-control" @bind="bookingCarDto.Status" required />
    </div>
</div>
<div class="mb-3">
    <label for="StartDate" class="form-label">Start Date:</label>
    <div>
        <input type="string" id="StartDate" class="form-control" @bind="bookingCarDto.Startdato" required />
    </div>
</div>

<div class="mb-3">
    <label for="StartTime" class="form-label">Start Time:</label>
    <div>
        <input type="string" id="StartTime" class="form-control" @bind="bookingCarDto.Starttime" required />
    </div>
</div>

<div class="mb-3">
    <label for="EndDate" class="form-label">End Date:</label>
    <div>
        <input type="string" id="EndDate" class="form-control" @bind="bookingCarDto.Enddate" required />
    </div>
</div>

<div class="mb-3">
    <label for="EndTime" class="form-label">End Time:</label>
    <div>
        <input type="string" id="EndTime" class="form-control" @bind="bookingCarDto.Endtime" required />
    </div>
</div>

<div class="mb-3">
    <label for="Price" class="form-label">Price:</label>
    <div>
        <input type="number" id="Price" class="form-control" @bind="bookingCarDto.Price" required />
    </div>
</div>

<div class="mb-3">
    <label for="GreenShare" class="form-label">Green Share:</label>
    <div>
        <input type="number" id="GreenShare" class="form-control" @bind="bookingCarDto.Greenshare" required />
    </div>
</div>

<div class="mb-3">
    <label for="CarId" class="form-label">Car ID:</label>
    <div>
        <input type="number" id="CarId" class="form-control" @bind="bookingCarDto.Carid" required />
    </div>
</div>

<div class="mb-3">
    <label for="CustomerId" class="form-label">Customer ID:</label>
    <div>
        <input type="number" id="CustomerId" class="form-control" @bind="bookingCarDto.Customerid" required />
    </div>
</div>

<div>
    <button class="btn btn-primary" @onclick="HandleAddBookingCar">Confirm Booking</button>
</div>


@if (_successMessage != null)
{
    <div class="alert alert-success mt-3">@_successMessage</div>
}
@if (_errorMessage != null)
{
    <div class="alert alert-danger mt-3">@_errorMessage</div>
}

@code
{
    private AddBookingCarRequestDto bookingCarDto = new AddBookingCarRequestDto();
    private string? _successMessage;
    private string? _errorMessage;
    
    private async Task HandleAddBookingCar()
    {
        _successMessage = null;
        _errorMessage = null;
        try
        {
            var response = await Http.PostAsJsonAsync("api/bookingcar", bookingCarDto);
            if (response.IsSuccessStatusCode)
            {
                _successMessage = "Car added successfully!";
                bookingCarDto = new AddBookingCarRequestDto(); 
            }
            else
            {
                _errorMessage = "Failed to add car. Please try again.";
            }
        }
        catch (Exception ex)
        {
            _errorMessage = $"Error: {ex.Message}";
        }
    }
}
